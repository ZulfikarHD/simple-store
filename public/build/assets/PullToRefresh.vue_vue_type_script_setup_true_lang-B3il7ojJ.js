import{d as B,r as s,c as o,y as M,E as P,a as w,e as l,p as b,g as z,f as C,q as S,G as $,n as D,o as f}from"./app-rYMLcSRK.js";import{u as F}from"./shopping-bag-B7J_X1G7.js";import{L as j}from"./loader-circle-CTO26N7A.js";const V={class:"flex h-10 w-10 items-center justify-center rounded-full bg-background shadow-lg ring-1 ring-border"},N=B({__name:"PullToRefresh",props:{threshold:{default:80},resistance:{default:.5},onRefresh:{type:Function,default:void 0},disabled:{type:Boolean,default:!1}},setup(E){const t=E,h=F(),i=s(null),a=s(!1),r=s(!1),n=s(0),p=s(0),u=s(!1),c=o(()=>Math.min(1,n.value/t.threshold)),R=o(()=>c.value*360),Y=o(()=>Math.min(1,c.value*1.5)),x=o(()=>({transform:`translateY(${n.value}px)`,transition:a.value?"none":"transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)"})),L=o(()=>({transform:`translateY(${Math.min(n.value,t.threshold+20)}px) rotate(${R.value}deg)`,opacity:Y.value,transition:a.value?"none":"all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)"}));function T(){return t.disabled?!1:(window.scrollY||document.documentElement.scrollTop)<=0}function m(e){r.value||(u.value=T(),u.value&&(p.value=e.touches[0].clientY,a.value=!0))}function y(e){if(!a.value||!u.value||r.value)return;const v=e.touches[0].clientY-p.value;if(v<=0){n.value=0;return}const k=v*t.resistance;n.value=k,k>=t.threshold&&n.value<t.threshold&&h.medium(),v>0&&e.preventDefault()}async function g(){a.value&&(a.value=!1,n.value>=t.threshold&&!r.value?await _():n.value=0)}async function _(){r.value=!0,n.value=t.threshold,h.success();try{t.onRefresh?await t.onRefresh():await new Promise(e=>{D.reload({onFinish:()=>e()})})}finally{r.value=!1,n.value=0}}return M(()=>{const e=i.value;e&&(e.addEventListener("touchstart",m,{passive:!0}),e.addEventListener("touchmove",y,{passive:!1}),e.addEventListener("touchend",g,{passive:!0}))}),P(()=>{const e=i.value;e&&(e.removeEventListener("touchstart",m),e.removeEventListener("touchmove",y),e.removeEventListener("touchend",g))}),(e,d)=>(f(),w("div",{ref_key:"containerRef",ref:i,class:"ios-ptr-container relative min-h-full"},[l("div",{class:"ios-ptr-indicator pointer-events-none absolute left-1/2 top-0 z-50 -translate-x-1/2",style:b(L.value)},[l("div",V,[r.value?(f(),z(C(j),{key:0,class:"h-5 w-5 animate-spin text-primary"})):(f(),w("svg",{key:1,class:S(["h-5 w-5 text-primary transition-transform",{"rotate-180":c.value>=1}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...d[0]||(d[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 14l-7 7m0 0l-7-7m7 7V3"},null,-1)])],2))])],4),l("div",{style:b(x.value)},[$(e.$slots,"default")],4)],512))}});export{N as _};
